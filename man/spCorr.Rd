% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spCorr.R
\name{spCorr}
\alias{spCorr}
\title{The wrapper for the whole spCorr pipeline}
\usage{
spCorr(
  count_mat,
  gene_list,
  gene_pair_list,
  cov_mat,
  formula1 = "1",
  family1 = "nb",
  formula2 = "s(x1, x2, bs='tp', k=50)",
  family2 = quasiproductr(),
  DT = TRUE,
  return_models = FALSE,
  ncores = 2,
  control = list(),
  seed = 123,
  local_testing = FALSE,
  preconstruct_smoother = TRUE
)
}
\arguments{
\item{count_mat}{A matrix of counts where rows represent genes and columns represent observations.}

\item{gene_list}{A vector of gene names or indices for which the conditional margins are to be fit.}

\item{gene_pair_list}{A data frame or matrix containing pairs of gene names (or indices) to be analyzed.}

\item{cov_mat}{A matrix or data frame of covariates used for fitting.}

\item{formula1}{A formula object or string specifying the model for fitting the marginal distributions (e.g., \code{~ covariate}).}

\item{family1}{The distribution family for marginal fitting. Options include \code{'gaussian'}, \code{'poisson'}, or \code{'nb'}. Default is \code{'nb'}.}

\item{formula2}{A formula object or string specifying the model for fitting the product distributions (e.g., \code{s(x1, x2, bs='tp', k=50)}).}

\item{family2}{The distribution family for product fitting. Default is \code{quasiproductr()}.}

\item{DT}{Logical. If \code{TRUE}, applies discrete transformation during margin fitting. Default is \code{TRUE}.}

\item{return_models}{Logical. If \code{TRUE}, returns the fitted model objects along with results. Default is \code{FALSE}.}

\item{ncores}{Integer. The number of cores to use for parallel processing. Default is \code{2}.}

\item{control}{A list of control parameters passed to the fitting functions.}

\item{seed}{Integer. Seed value for reproducibility. Default is \code{123}.}

\item{local_testing}{Logical. If \code{TRUE}, performs local testing for each gene pair. Default is \code{FALSE}.}

\item{preconstruct_smoother}{Logical. If \code{TRUE}, uses a cached smoother to speed up computations. Default is \code{TRUE}.}
}
\value{
A list containing:
\describe{
\item{test_res}{A list of results from testing the fitted product distributions.}
\item{gene_expr}{A list of gene expression matrices for each gene pair.}
\item{cov_mat}{The covariate matrix used in the fitting.}
\item{model_list}{The fitted model objects, if \code{return_models = TRUE}.}
}
}
\description{
This function fits conditional margins and product distributions for a given list of genes and gene pairs using GAM-based models.
It also performs statistical testing to identify significant patterns in gene co-expression.
}
\examples{
data(test_data)
result <- spCorr(
  count_mat = test_data$count_mat,
  gene_list = test_data$gene_list,
  gene_pair_list = test_data$gene_pair_list,
  cov_mat = test_data$cov_mat,
  formula1 = "layer_annotations",
  family1 = "nb",
  formula2 = "s(x1, x2, bs='tp', k=50)",
  family2 = quasiproductr(),
  DT = TRUE,
  return_models = FALSE,
  ncores = 2,
  control = list(),
  seed = 123,
  local_testing = FALSE,
  preconstruct_smoother = TRUE
)
}
